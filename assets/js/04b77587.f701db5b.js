"use strict";(self.webpackChunkrke_docs=self.webpackChunkrke_docs||[]).push([[3092],{9568:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>x,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var o=s(5893),t=s(1151);const i={title:"SSH Connectivity Errors"},r=void 0,d={id:"troubleshooting/ssh-connectivity-errors/ssh-connectivity-errors",title:"SSH Connectivity Errors",description:"Failed to set up SSH tunneling for host [xxx.xxx.xxx.xxx]: Can't retrieve Docker Info",source:"@site/docs/troubleshooting/ssh-connectivity-errors/ssh-connectivity-errors.md",sourceDirName:"troubleshooting/ssh-connectivity-errors",slug:"/troubleshooting/ssh-connectivity-errors/",permalink:"/troubleshooting/ssh-connectivity-errors/",draft:!1,unlisted:!1,editUrl:"https://github.com/rancher/rke1-docs/edit/main/docs/troubleshooting/ssh-connectivity-errors/ssh-connectivity-errors.md",tags:[],version:"current",lastUpdatedAt:1704844723,formattedLastUpdatedAt:"Jan 9, 2024",frontMatter:{title:"SSH Connectivity Errors"},sidebar:"mySidebar",previous:{title:"Troubleshooting",permalink:"/troubleshooting/"},next:{title:"Provisioning Errors",permalink:"/troubleshooting/provisioning-errors/"}},x={},c=[{value:"Failed to set up SSH tunneling for host [xxx.xxx.xxx.xxx]: Can&#39;t retrieve Docker Info",id:"failed-to-set-up-ssh-tunneling-for-host-xxxxxxxxxxxx-cant-retrieve-docker-info",level:3},{value:"Failed to dial to /var/run/docker.sock: ssh: rejected: administratively prohibited (open failed)",id:"failed-to-dial-to-varrundockersock-ssh-rejected-administratively-prohibited-open-failed",level:4},{value:"Failed to dial ssh using address [xxx.xxx.xxx.xxx]: Error configuring SSH: ssh: no key found",id:"failed-to-dial-ssh-using-address-xxxxxxxxxxxx-error-configuring-ssh-ssh-no-key-found",level:4},{value:"Failed to dial ssh using address [xxx.xxx.xxx.xxx]: ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain",id:"failed-to-dial-ssh-using-address-xxxxxxxxxxxx-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain",level:4},{value:"Failed to dial ssh using address [xxx.xxx.xxx.xxx]: Error configuring SSH: ssh: cannot decode encrypted private keys",id:"failed-to-dial-ssh-using-address-xxxxxxxxxxxx-error-configuring-ssh-ssh-cannot-decode-encrypted-private-keys",level:4},{value:"Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?",id:"cannot-connect-to-the-docker-daemon-at-unixvarrundockersock-is-the-docker-daemon-running",level:4}];function a(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"failed-to-set-up-ssh-tunneling-for-host-xxxxxxxxxxxx-cant-retrieve-docker-info",children:"Failed to set up SSH tunneling for host [xxx.xxx.xxx.xxx]: Can't retrieve Docker Info"}),"\n",(0,o.jsx)(n.h4,{id:"failed-to-dial-to-varrundockersock-ssh-rejected-administratively-prohibited-open-failed",children:"Failed to dial to /var/run/docker.sock: ssh: rejected: administratively prohibited (open failed)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["User specified to connect with does not have permission to access the Docker socket. This can be checked by logging into the host and running the command ",(0,o.jsx)(n.code,{children:"docker ps"}),":"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"$ ssh -i ssh_privatekey_file user@server\nuser@server$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\n"})}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user",children:"Manage Docker as a non-root user"})," how to set this up properly."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["When using RedHat/CentOS as operating system, you cannot use the user ",(0,o.jsx)(n.code,{children:"root"})," to connect to the nodes because of ",(0,o.jsx)(n.a,{href:"https://bugzilla.redhat.com/show_bug.cgi?id=1527565",children:"Bugzilla #1527565"}),". You will need to add a separate user and configure it to access the Docker socket. See ",(0,o.jsx)(n.a,{href:"/os/#red-hat-enterprise-linux-rhel--oracle-linux-ol--centos",children:"RKE OS Requirements"})," for more on how to set this up."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["SSH server version is not version 6.7 or higher. This is needed for socket forwarding to work, which is used to connect to the Docker socket over SSH. This can be checked using ",(0,o.jsx)(n.code,{children:"sshd -V"})," on the host you are connecting to, or using netcat:"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"$ nc xxx.xxx.xxx.xxx 22\nSSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.10\n"})}),"\n",(0,o.jsxs)(n.h4,{id:"failed-to-dial-ssh-using-address-xxxxxxxxxxxx-error-configuring-ssh-ssh-no-key-found",children:["Failed to dial ssh using address [xxx.xxx.xxx.xxx",":xx","]: Error configuring SSH: ssh: no key found"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The key file specified as ",(0,o.jsx)(n.code,{children:"ssh_key_path"})," cannot be accessed. Make sure that you specified the private key file (not the public key, ",(0,o.jsx)(n.code,{children:".pub"}),"), and that the user that is running the ",(0,o.jsx)(n.code,{children:"rke"})," command can access the private key file."]}),"\n",(0,o.jsxs)(n.li,{children:["The key file specified as ",(0,o.jsx)(n.code,{children:"ssh_key_path"})," is malformed. Check if the key is valid by running ",(0,o.jsx)(n.code,{children:"ssh-keygen -y -e -f private_key_file"}),". This will print the public key of the private key, which will fail if the private key file is not valid."]}),"\n"]}),"\n",(0,o.jsxs)(n.h4,{id:"failed-to-dial-ssh-using-address-xxxxxxxxxxxx-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain",children:["Failed to dial ssh using address [xxx.xxx.xxx.xxx",":xx","]: ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The key file specified as ",(0,o.jsx)(n.code,{children:"ssh_key_path"})," is not correct for accessing the node. Double-check if you specified the correct ",(0,o.jsx)(n.code,{children:"ssh_key_path"})," for the node and if you specified the correct user to connect with."]}),"\n"]}),"\n",(0,o.jsxs)(n.h4,{id:"failed-to-dial-ssh-using-address-xxxxxxxxxxxx-error-configuring-ssh-ssh-cannot-decode-encrypted-private-keys",children:["Failed to dial ssh using address [xxx.xxx.xxx.xxx",":xx","]: Error configuring SSH: ssh: cannot decode encrypted private keys"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["If you want to use encrypted private keys, you should use ",(0,o.jsx)(n.code,{children:"ssh-agent"})," to load your keys with your passphrase. You can configure RKE to use that agent by specifying ",(0,o.jsx)(n.code,{children:"--ssh-agent-auth"})," on the command-line, it will use the ",(0,o.jsx)(n.code,{children:"SSH_AUTH_SOCK"})," environment variable in the environment where the ",(0,o.jsx)(n.code,{children:"rke"})," command is run."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"cannot-connect-to-the-docker-daemon-at-unixvarrundockersock-is-the-docker-daemon-running",children:"Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The node is not reachable on the configured ",(0,o.jsx)(n.code,{children:"address"})," and ",(0,o.jsx)(n.code,{children:"port"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>d,a:()=>r});var o=s(7294);const t={},i=o.createContext(t);function r(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);