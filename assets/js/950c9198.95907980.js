"use strict";(self.webpackChunkrke_docs=self.webpackChunkrke_docs||[]).push([[7839],{2425:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});var d=s(5893),o=s(1151);const i={title:"Add-Ons"},r=void 0,t={id:"config-options/add-ons/add-ons",title:"Add-Ons",description:"RKE supports configuring pluggable add-ons in the cluster YML. Add-ons are used to deploy several cluster components including:",source:"@site/docs/config-options/add-ons/add-ons.md",sourceDirName:"config-options/add-ons",slug:"/config-options/add-ons/",permalink:"/config-options/add-ons/",draft:!1,unlisted:!1,editUrl:"https://github.com/rancher/rke1-docs/edit/main/docs/config-options/add-ons/add-ons.md",tags:[],version:"current",lastUpdatedAt:1704844723,formattedLastUpdatedAt:"Jan 9, 2024",frontMatter:{title:"Add-Ons"},sidebar:"mySidebar",previous:{title:"Dual-stack",permalink:"/config-options/dual-stack/"},next:{title:"Network Plug-ins",permalink:"/config-options/add-ons/network-plugins/"}},c={},l=[{value:"Critical and Non-Critical Add-ons",id:"critical-and-non-critical-add-ons",level:2},{value:"Add-on Deployment Jobs",id:"add-on-deployment-jobs",level:2},{value:"Add-on Placement",id:"add-on-placement",level:2},{value:"Tolerations",id:"tolerations",level:2}];function a(e){const n={a:"a",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.p,{children:"RKE supports configuring pluggable add-ons in the cluster YML. Add-ons are used to deploy several cluster components including:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"/config-options/add-ons/network-plugins/",children:"Network plug-ins"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"/config-options/add-ons/ingress-controllers/",children:"Ingress controller"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"/config-options/add-ons/dns/",children:"DNS provider"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"/config-options/add-ons/metrics-server/",children:"Metrics Server"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["These add-ons require images that can be found under the ",(0,d.jsxs)(n.a,{href:"/config-options/system-images/",children:[(0,d.jsx)(n.code,{children:"system_images"})," directive"]}),". For each Kubernetes version, there are default images associated with each add-on, but these can be overridden by changing the image tag in ",(0,d.jsx)(n.code,{children:"system_images"}),"."]}),"\n",(0,d.jsx)(n.p,{children:"There are a few things worth noting:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"In addition to these pluggable add-ons, you can specify an add-on that you want deployed after the cluster deployment is complete."}),"\n",(0,d.jsx)(n.li,{children:"As of v0.1.8, RKE will update an add-on if it is the same name."}),"\n",(0,d.jsxs)(n.li,{children:["Before v0.1.8, update any add-ons by using ",(0,d.jsx)(n.code,{children:"kubectl edit"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"#critical-and-non-critical-add-ons",children:"Critical and Non-Critical Add-ons"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"#add-on-deployment-jobs",children:"Add-on Deployment Jobs"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"#add-on-placement",children:"Add-on Placement"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"#tolerations",children:"Tolerations"})}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"critical-and-non-critical-add-ons",children:"Critical and Non-Critical Add-ons"}),"\n",(0,d.jsx)(n.p,{children:"As of version v0.1.7, add-ons are split into two categories:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Critical add-ons:"})," If these add-ons fail to deploy for any reason, RKE will error out. All system add-ons, such as the ",(0,d.jsx)(n.a,{href:"/config-options/add-ons/network-plugins/",children:"network plug-in"}),", KubeDNS, and ",(0,d.jsx)(n.a,{href:"/config-options/add-ons/ingress-controllers/",children:"ingress controllers"}),", are considered critical."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Non-critical add-ons:"})," If these add-ons fail to deploy, RKE will only log a warning and continue deploying any other add-ons. ",(0,d.jsx)(n.a,{href:"/config-options/add-ons/user-defined-add-ons/",children:"User-defined add-ons"})," are considered non-critical."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"add-on-deployment-jobs",children:"Add-on Deployment Jobs"}),"\n",(0,d.jsx)(n.p,{children:"RKE uses Kubernetes jobs to deploy add-ons. In some cases, add-ons deployment takes longer than expected. As of with version v0.1.7, RKE provides an option to control the job check timeout in seconds. This timeout is set at the cluster level."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"addon_job_timeout: 30\n"})}),"\n",(0,d.jsx)(n.h2,{id:"add-on-placement",children:"Add-on Placement"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:"Applies to v0.2.3 and higher"})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Component"}),(0,d.jsx)(n.th,{children:"nodeAffinity nodeSelectorTerms"}),(0,d.jsx)(n.th,{children:"nodeSelector"}),(0,d.jsx)(n.th,{children:"Tolerations"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Calico"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:NotIn:windows"})}),(0,d.jsx)(n.td,{children:"none"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"NoSchedule:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"NoExecute:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"CriticalAddonsOnly:Exists"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Flannel"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:NotIn:windows"})}),(0,d.jsx)(n.td,{children:"none"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"operator:Exists"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Canal"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:NotIn:windows"})}),(0,d.jsx)(n.td,{children:"none"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"NoSchedule:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"NoExecute:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"CriticalAddonsOnly:Exists"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Weave"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:NotIn:windows"})}),(0,d.jsx)(n.td,{children:"none"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"NoSchedule:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"NoExecute:Exists"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"CoreDNS"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"node-role.kubernetes.io/worker:Exists"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:linux"})}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"NoSchedule:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"NoExecute:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"CriticalAddonsOnly:Exists"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"kube-dns"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:NotIn:windows"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"node-role.kubernetes.io/worker"})," ",(0,d.jsx)(n.code,{children:"Exists"})]}),(0,d.jsx)(n.td,{children:"none"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"NoSchedule:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"NoExecute:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"CriticalAddonsOnly:Exists"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"nginx-ingress"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:NotIn:windows"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"node-role.kubernetes.io/worker"})," ",(0,d.jsx)(n.code,{children:"Exists"})]}),(0,d.jsx)(n.td,{children:"none"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"NoSchedule:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"NoExecute:Exists"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"metrics-server"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"beta.kubernetes.io/os:NotIn:windows"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"node-role.kubernetes.io/worker"})," ",(0,d.jsx)(n.code,{children:"Exists"})]}),(0,d.jsx)(n.td,{children:"none"}),(0,d.jsxs)(n.td,{children:["- ",(0,d.jsx)(n.code,{children:"NoSchedule:Exists"}),(0,d.jsx)("br",{}),"- ",(0,d.jsx)(n.code,{children:"NoExecute:Exists"})]})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"tolerations",children:"Tolerations"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:"Available as of v1.2.4"})}),"\n",(0,d.jsx)(n.p,{children:"Tolerations can be configured per add-on and apply to Deployment resources. The configured tolerations will replace the existing tolerations so make sure you configure all the tolerations you need. See the specific add-on doc pages for more information."})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>t,a:()=>r});var d=s(7294);const o={},i=d.createContext(o);function r(e){const n=d.useContext(i);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),d.createElement(i.Provider,{value:n},e.children)}}}]);